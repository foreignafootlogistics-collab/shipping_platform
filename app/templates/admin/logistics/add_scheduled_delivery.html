{% extends 'layout_admin.html' %}
{% block title %}Add Schedule Delivery{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>ðŸ“¦ Add Schedule Delivery</h2>

    <form id="adminScheduleDeliveryForm">
        <div class="row g-2">
            <div class="col-md-3">
                <label>User</label>
                <select class="form-select" id="userSelect" required>
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.full_name }} ({{ user.email }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2"><label>Date</label><input type="date" id="deliveryDate" class="form-control" required></div>
            <div class="col-md-2"><label>Time</label><input type="time" id="deliveryTime" class="form-control" required></div>
            <div class="col-md-3"><label>Location</label><input type="text" id="deliveryLocation" class="form-control" required></div>
            <div class="col-md-2"><label>Person Receiving</label><input type="text" id="deliveryPerson" class="form-control"></div>
        </div>
        <div class="row mt-3 g-2">
            <div class="col-md-6"><input type="text" id="deliveryDirections" placeholder="Directions" class="form-control"></div>
            <div class="col-md-6"><input type="text" id="deliveryMobile" placeholder="Mobile #" class="form-control"></div>
        </div>
        <button type="submit" class="btn btn-success mt-3">Add Delivery</button>
    </form>

    <div id="resultMessage" class="mt-3"></div>
</div>

<script>
document.getElementById("adminScheduleDeliveryForm").addEventListener("submit", function(e){
    e.preventDefault();

    const payload = {
        user_id: document.getElementById("userSelect").value,
        date: document.getElementById("deliveryDate").value,
        time: document.getElementById("deliveryTime").value,
        location: document.getElementById("deliveryLocation").value,
        directions: document.getElementById("deliveryDirections").value,
        mobile: document.getElementById("deliveryMobile").value,
        person_receiving: document.getElementById("deliveryPerson").value
    };

    fetch("{{ url_for('logistics.add_schedule_delivery') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {
        const msgDiv = document.getElementById("resultMessage");
        if(data.status === "success"){
            msgDiv.innerHTML = `<div class="alert alert-success">Delivery scheduled successfully for user ID ${data.delivery.user_id}.</div>`;
            this.reset();
        } else {
            msgDiv.innerHTML = `<div class="alert alert-danger">${data.message || "Error scheduling delivery"}</div>`;
        }
    });
});
</script>
{% endblock %}
