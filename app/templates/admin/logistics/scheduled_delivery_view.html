{% extends "layout_admin.html" %}
{% block title %}Scheduled Delivery{% endblock %}

{% block content %}
<div class="container-fluid">

  <!-- Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-1">
        <i class="fas fa-truck me-2 text-primary"></i>
        Scheduled Delivery
      </h3>
      <div class="text-muted">
        Delivery ID: <strong>#{{ delivery.id }}</strong>
        {% if delivery.status %}
          <span class="badge ms-2
            {% if delivery.status|lower == 'delivered' %} bg-success
            {% elif delivery.status|lower in ['cancelled','canceled'] %} bg-danger
            {% elif delivery.status|lower == 'in progress' %} bg-warning text-dark
            {% else %} bg-secondary {% endif %}">
            {{ delivery.status }}
          </span>
        {% endif %}
      </div>
    </div>

    <div class="d-flex gap-2 mt-2 mt-md-0">
      <a href="{{ url_for('logistics.view_scheduled_deliveries') }}" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-arrow-left me-1"></i> Back
      </a>

      <!-- Step 4+ will wire these buttons -->
      <button class="btn btn-sm btn-success" disabled>
        <i class="fas fa-link me-1"></i> Assign Packages
      </button>
      <button class="btn btn-sm btn-outline-primary" disabled>
        <i class="fas fa-edit me-1"></i> Update Status
      </button>
    </div>
  </div>

  <div class="row g-3">

    <!-- Left: Delivery Info -->
    <div class="col-lg-5">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white">
          <h6 class="mb-0"><i class="fas fa-info-circle me-2 text-muted"></i>Delivery Details</h6>
        </div>

        <div class="card-body">
          <div class="row g-3">
            <div class="col-6">
              <div class="text-muted small">Date</div>
              <div class="fw-semibold">
                {{ delivery.scheduled_date.strftime("%Y-%m-%d") if delivery.scheduled_date else "—" }}
              </div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Time</div>
              <div class="fw-semibold">{{ delivery.scheduled_time or "—" }}</div>
            </div>

            <div class="col-12">
              <div class="text-muted small">Customer</div>
              <div class="fw-semibold">
                {{ delivery.user.full_name if delivery.user else "N/A" }}
              </div>
              <div class="text-muted small">
                {{ delivery.user.email if delivery.user and delivery.user.email else "" }}
              </div>
            </div>

            <div class="col-12">
              <div class="text-muted small">Location</div>
              <div class="fw-semibold">{{ delivery.location or "—" }}</div>
              {% if delivery.direction %}
                <div class="text-muted small mt-1">
                  <i class="fas fa-location-arrow me-1"></i>{{ delivery.direction }}
                </div>
              {% endif %}
            </div>

            <div class="col-6">
              <div class="text-muted small">Person Receiving</div>
              <div class="fw-semibold">{{ delivery.person_receiving or "—" }}</div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Mobile</div>
              <div class="fw-semibold">{{ delivery.mobile_number or "—" }}</div>
            </div>
          </div>

          <hr class="my-3">

          <div class="d-flex justify-content-between align-items-center">
            <div class="text-muted small">Created</div>
            <div class="small">
              {{ delivery.created_at.strftime("%Y-%m-%d %H:%M") if delivery.created_at else "—" }}
            </div>
          </div>
        </div>
      </div>

      <!-- Nice “next actions” card -->
      <div class="card shadow-sm border-0 mt-3">
        <div class="card-body">
          <h6 class="mb-2"><i class="fas fa-bolt me-2 text-warning"></i>Next Actions</h6>
          <ul class="mb-0 small text-muted">
            <li>Step 3: Show unassigned packages for this customer</li>
            <li>Step 4: Assign selected packages to this delivery</li>
            <li>Step 5: Display linked packages + remove option</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Right: Linked Packages -->
    <div class="col-lg-7">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <h6 class="mb-0"><i class="fas fa-boxes me-2 text-muted"></i>Linked Packages</h6>
          <span class="badge bg-dark">
            {{ linked_packages|length }}
          </span>
        </div>

        <div class="card-body table-responsive">
          {% if linked_packages and linked_packages|length > 0 %}
            <table class="table table-sm table-striped align-middle">
              <thead class="table-dark">
                <tr>
                  <th>Tracking</th>
                  <th>Description</th>
                  <th class="text-end">Weight</th>
                  <th>Status</th>
                  <th class="text-end">Created</th>
                </tr>
              </thead>
              <tbody>
                {% for p in linked_packages %}
                <tr>
                  <td class="fw-semibold">{{ p.tracking_number or p.house_awb or "—" }}</td>
                  <td>{{ p.description or "—" }}</td>
                  <td class="text-end">{{ "%.2f"|format(p.weight or 0) }}</td>
                  <td>
                    <span class="badge bg-secondary">{{ p.status or "—" }}</span>
                  </td>
                  <td class="text-end small text-muted">
                    {{ p.created_at.strftime("%Y-%m-%d") if p.created_at else "—" }}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="text-center py-5">
              <div class="mb-2">
                <i class="fas fa-link fa-2x text-muted"></i>
              </div>
              <h6 class="mb-1">No packages linked yet</h6>
              <div class="text-muted small">
                Next we’ll add an “Assign Packages” section so operations can attach packages to this delivery.
              </div>
            </div>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

</div>
{% endblock %}

