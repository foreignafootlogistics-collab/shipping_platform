{% extends "layout_customer.html" %}
{% block title %}View Pre-Alert Shipments{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3>ðŸ“¦ Your Pre-Alert Shipments</h3>

    <div class="d-flex justify-content-between mb-3">
        <a href="{{ url_for('customer.prealerts_create') }}" class="btn btn-dashboard">
          Create New Pre-Alert Shipment
        </a>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="table-responsive">
      <table class="table table-hover table-striped table-bordered align-middle">
        <thead class="table-dark">
          <tr>
            <th>Pre-Alert #</th>
            <th>Vendor</th>
            <th>Courier</th>
            <th>Tracking #</th>
            <th>Purchase Date</th>
            <th>Contents</th>
            <th>Value (USD)</th>
            <th>Invoice</th>
            <th>Submitted On</th>
          </tr>
        </thead>
        <tbody>
          {% if prealerts %}
            {% for p in prealerts %}
            <tr>
              <!-- Pre-Alert # -->
              <td>
                {% if p.prealert_number %}
                  PA-{{ "%05d"|format(p.prealert_number) }}
                {% else %}
                  {{ p.id }}
                {% endif %}
              </td>


              <!-- Vendor -->
              <td>{{ p.vendor_name or 'N/A' }}</td>

              <!-- Courier -->
              <td>{{ p.courier_name or 'N/A' }}</td>

              <!-- Tracking # -->
              <td>{{ p.tracking_number or 'N/A' }}</td>

              <!-- Purchase Date -->
              <td>
                {% if p.purchase_date %}
                  {{ p.purchase_date }}
                  {# or, if it's a datetime and you want formatting:
                     {{ p.purchase_date.strftime("%Y-%m-%d") }} #}
                {% else %}
                  N/A
                {% endif %}
              </td>

              <!-- Contents -->
              <td>{{ p.package_contents or 'N/A' }}</td>

              <!-- Value (USD) -->
              <td>
                ${{ "%.2f"|format(p.item_value_usd or 0) }}
              </td>

              <!-- Invoice -->
              <td>
                {% if p.invoice_filename %}
                  <a href="{{ url_for('static', filename='uploads/invoices/' ~ p.invoice_filename) }}"
                     target="_blank">
                    View
                  </a>
                {% else %}
                  N/A
                {% endif %}
              </td>

              <!-- Submitted On -->
              <td>
                {% if p.created_at %}
                  {{ p.created_at }}
                  {# or format if needed:
                     {{ p.created_at.strftime("%Y-%m-%d %H:%M") }} #}
                {% else %}
                  N/A
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="9" class="text-center text-muted">No pre-alert shipments available.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
</div>
{% endblock %}
