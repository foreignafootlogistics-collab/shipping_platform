{% extends "layout_customer.html" %}
{% block title %}Schedule Delivery{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>ðŸ“¦ Schedule Delivery</h2>
    <p class="text-muted">Below is your current delivery schedule. You can add a new delivery or cancel an existing one.</p>

    <!-- Add Delivery Button -->
    <button class="btn btn-primary mb-3" id="scheduleDeliveryBtn">+ Schedule New Delivery</button>

    <!-- Inline Add Form -->
    <div id="scheduleDeliveryForm" class="card p-3 mb-4" style="display:none;">
        <div class="row g-2">
            <div class="col-md-2"><input type="date" id="deliveryDate" class="form-control"></div>
            <div class="col-md-2"><input type="time" id="deliveryTime" class="form-control"></div>
            <div class="col-md-2"><input type="text" id="deliveryLocation" placeholder="Location" class="form-control"></div>
            <div class="col-md-2"><input type="text" id="deliveryDirections" placeholder="Directions" class="form-control"></div>
            <div class="col-md-2"><input type="text" id="deliveryMobile" placeholder="Mobile #" class="form-control"></div>
            <div class="col-md-2"><input type="text" id="deliveryPerson" placeholder="Person Receiving" class="form-control"></div>
        </div>
        <div class="mt-3">
            <button class="btn btn-success" id="saveScheduleDelivery">Save</button>
            <button class="btn btn-secondary" id="cancelScheduleDelivery">Cancel</button>
        </div>
    </div>

    <!-- Deliveries Table -->
    <table class="table table-striped" id="scheduledDeliveriesList">
        <thead>
            <tr>
                <th>Date</th><th>Time</th><th>Location</th><th>Person Receiving</th><th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for delivery in deliveries %}
            <tr>
                <td>{{ delivery.date }}</td>
                <td>{{ delivery.time }}</td>
                <td>{{ delivery.location }}</td>
                <td>{{ delivery.person_receiving }}</td>
                <td>{{ delivery.status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
document.getElementById("scheduleDeliveryBtn").onclick = () => {
    document.getElementById("scheduleDeliveryForm").style.display = "block";
    document.getElementById("scheduleDeliveryBtn").style.display = "none";
};
document.getElementById("cancelScheduleDelivery").onclick = () => {
    document.getElementById("scheduleDeliveryForm").style.display = "none";
    document.getElementById("scheduleDeliveryBtn").style.display = "inline-block";
};

document.getElementById("saveScheduleDelivery").onclick = function() {
    const date = document.getElementById("deliveryDate").value;
    const time = document.getElementById("deliveryTime").value;
    const location = document.getElementById("deliveryLocation").value;
    const directions = document.getElementById("deliveryDirections").value;
    const mobile = document.getElementById("deliveryMobile").value;
    const personReceiving = document.getElementById("deliveryPerson").value;

    fetch("{{ url_for('customer.schedule_delivery_add') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ date, time, location, directions, mobile, person_receiving: personReceiving })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            const table = document.querySelector("#scheduledDeliveriesList tbody");
            const row = `<tr>
                <td>${data.delivery.date}</td>
                <td>${data.delivery.time}</td>
                <td>${data.delivery.location}</td>
                <td>${data.delivery.person_receiving}</td>
                <td>${data.delivery.status}</td>
            </tr>`;
            table.insertAdjacentHTML("beforeend", row);
            document.getElementById("scheduleDeliveryForm").style.display = "none";
            document.getElementById("scheduleDeliveryBtn").style.display = "inline-block";
        }
    });
};
</script>
{% endblock %}
