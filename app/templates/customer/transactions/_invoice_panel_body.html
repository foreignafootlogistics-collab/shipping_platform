{# NO extends - panel partial #}

<div class="mxk-card">

  <div class="mxk-top">
    <div class="d-flex justify-content-between align-items-start">
      <div class="d-flex align-items-center gap-2">
        <div class="mxk-logo">FAFL</div>
        <div>
          <div class="small text-muted">Invoice</div>
          <div class="fw-bold">{{ invoice.number }}</div>
          <div class="small text-muted">{{ invoice.date_display }}</div>
        </div>
      </div>

      {% set is_paid = (invoice.total_due or 0) <= 0 %}
      <span class="badge rounded-pill {% if is_paid %}bg-success{% else %}bg-warning text-dark{% endif %}">
        {% if is_paid %}PAID{% else %}PENDING{% endif %}
      </span>
    </div>

    <div class="mt-3 d-flex justify-content-between align-items-center">
      <div class="small text-muted">
        Customer<br>
        <span class="fw-bold text-dark">{{ invoice.customer_name }}</span><br>
        <span class="text-muted">{{ invoice.customer_code }}</span>
      </div>

      <div class="text-end">
        <div class="small text-muted">Amount Owed</div>
        <div class="h5 fw-bold mb-0">{{ (invoice.total_due or 0)|jmd }}</div>
      </div>
    </div>
  </div>

  <div class="mxk-sec">
    <div class="fw-bold mb-2">Billing Summary</div>

    <div class="mxk-row"><span>Subtotal</span><span>{{ (invoice.subtotal or 0)|jmd }}</span></div>
    <div class="mxk-row"><span>Discounts</span><span>- {{ (invoice.discount_total or 0)|jmd }}</span></div>

    <hr class="my-2">

    <div class="d-flex justify-content-between fw-bold">
      <span>Total Due</span>
      <span>{{ (invoice.total_due or 0)|jmd }}</span>
    </div>
  </div>

  <div class="mxk-sec">
    <div class="fw-bold mb-2">Packages</div>

    {% for p in invoice.packages %}
      <div class="mxk-pkg">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <div class="fw-bold">{{ p.house_awb or "—" }}</div>
            <div class="small text-muted">{{ p.weight }} lbs • USD ${{ "%.2f"|format(p.value or 0) }}</div>
            {% if p.description %}<div class="small text-muted mt-1">{{ p.description }}</div>{% endif %}
          </div>
          <div class="text-end">
            <div class="small text-muted">Discount</div>
            <div class="fw-bold">{{ (p.discount_due or 0)|jmd }}</div>
          </div>
        </div>

        <div class="row g-2 mt-2">
          <div class="col-6">
            <div class="mxk-mini-title">Our Fees</div>
            <div class="mxk-mini"><span>Freight</span><span>{{ (p.freight or 0)|jmd }}</span></div>
            <div class="mxk-mini"><span>Handling</span><span>{{ (p.handling or 0)|jmd }}</span></div>
            <div class="mxk-mini"><span>Other</span><span>{{ (p.other_charges or 0)|jmd }}</span></div>
          </div>
          <div class="col-6">
            <div class="mxk-mini-title">Govt Fees</div>
            <div class="mxk-mini"><span>Duty</span><span>{{ (p.duty or 0)|jmd }}</span></div>
            <div class="mxk-mini"><span>SCF</span><span>{{ (p.scf or 0)|jmd }}</span></div>
            <div class="mxk-mini"><span>ENVL</span><span>{{ (p.envl or 0)|jmd }}</span></div>
            <div class="mxk-mini"><span>CAF</span><span>{{ (p.caf or 0)|jmd }}</span></div>
            <div class="mxk-mini"><span>GCT</span><span>{{ (p.gct or 0)|jmd }}</span></div>
          </div>
        </div>
      </div>
    {% else %}
      <div class="text-muted small">No packages found.</div>
    {% endfor %}
  </div>

  <div class="mxk-sec">
    <a class="mxk-btn w-100"
       href="{{ url_for('customer.view_invoice_customer', invoice_id=invoice.id) }}">
      View Full Invoice
    </a>
  </div>
</div>

<style>
  .mxk-card{border:1px solid #e5e7eb;border-radius:14px;overflow:hidden;background:#fff;}
  .mxk-top{padding:14px;background:linear-gradient(180deg, rgba(74,20,140,.10), rgba(74,20,140,0));}
  .mxk-logo{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:#4A148C;color:#fff;font-weight:800;letter-spacing:.5px;}
  .mxk-sec{padding:14px;border-top:1px solid #eef2f7;}
  .mxk-row{display:flex;justify-content:space-between;padding:6px 0;font-size:.95rem;}
  .mxk-pkg{border:1px solid #eef2f7;border-radius:14px;padding:12px;background:#fff;margin-bottom:10px;}
  .mxk-mini-title{font-weight:700;font-size:.85rem;margin-bottom:6px;color:#111827;}
  .mxk-mini{display:flex;justify-content:space-between;font-size:.9rem;padding:2px 0;color:#111827;}
  .mxk-btn{display:inline-block;text-align:center;background:#4A148C;color:#fff;border:1px solid #4A148C;border-radius:12px;padding:.7rem 1rem;text-decoration:none;}
  .mxk-btn:hover{filter:brightness(.92);color:#fff;}
</style>
