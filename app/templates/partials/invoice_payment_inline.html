<form method="POST" action="{{ url_for('logistics.add_payment', invoice_id=invoice.id) }}">
  {{ form.hidden_tag() }}

  <div class="row">
    <!-- Left: Keypad -->
    <div class="col-md-7 border-end">
      <div class="mb-2">
        {{ form.amount(class="form-control form-control-lg text-end fw-bold",
                       id="paymentAmount",
                       readonly=True,
                       value="0") }}
      </div>

      <div class="row g-2">
        {% set keys = ["7","8","9","4","5","6","1","2","3","0","00","."] %}
        {% for key in keys %}
        <div class="col-4">
          <!-- keypad buttons -->
          <button type="button" class="btn btn-outline-secondary w-100 py-3"
                  onclick="appendPayment('{{ key }}')">{{ key }}</button>
        </div>
        {% endfor %}

        <!-- Clear -->
        <div class="col-6">
          <button type="button" class="btn btn-outline-danger w-100 py-3" onclick="clearPayment()">Clear</button>
        </div>

        <!-- Confirm (submit button) -->
        <div class="col-6">
          <button type="submit" class="btn btn-success w-100 py-3">Confirm Payment</button>
        </div>
      </div>
    </div>

    <!-- Right: Payment Methods -->
    <div class="col-md-5">
      <div class="alert alert-danger text-center fw-bold fs-5" id="paymentDisplay">JMD 0.00</div>

      <div class="list-group">
        {% for value, label in form.payment_type.choices %}
        <label class="list-group-item d-flex justify-content-between align-items-center">
          <input type="radio"
                 name="{{ form.payment_type.name }}"
                 value="{{ value }}"
                 class="form-check-input me-2"
                 required>
          {{ label }}
          <i class="fas fa-{{ 'university' if value == 'Bank Transfer'
                              else 'money-bill-wave' if value == 'Cash'
                              else 'file-invoice' if 'Check' in value
                              else 'credit-card' if 'Card' in value
                              else 'gift' if value == 'Gift Card'
                              else 'dollar-sign' }}"></i>
        </label>
        {% endfor %}
      </div>
    </div>
  </div>
</form>


<script>
function appendPayment(val) {
  let input = document.getElementById("paymentAmount");
  if (input.value === "0") input.value = val;
  else input.value += val;
  updatePaymentDisplay();
}

function clearPayment() {
  let input = document.getElementById("paymentAmount");
  input.value = "0";
  updatePaymentDisplay();
}

function updatePaymentDisplay() {
  let input = document.getElementById("paymentAmount");
  let amt = input.value;
  document.getElementById("paymentDisplay").innerText = "JMD " + amt;
}
</script>
